{
  "hash": "125e3d17bcf0d85f6bdbeabcb27cafa9",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"The callback pattern\"\nauthor: \"Akshay Shankar\"\ndate: \"2025-05-05\"\ncategories: [tidbit, code]\nimage: \"julia.png\"\n---\n\nOne of my favourite design patterns is the `Callback` (also known as the [`Command`](https://gameprogrammingpatterns.com/command.html\n) pattern in object-oriented contexts). Loosely speaking, a callback is simply a function `f` whose reference has been passed on to another function `g` which then proceeds to invoke `f` upon completion at a later time. It is trivially usable in languages that implement functions as first-class citizens (where they may be passed around as arguments with no hassle). While the idea is quite simple, it can lend itself to some very powerful and intuitive user interfaces! I've had natural use-cases arise both during my day-to-day research as well as during game development.\n\nLet us consider a simple and perhaps a bit over-engineered example using Julia to demonstrate this idea. Say we want to write a generic interface for a differential equation solver. (Note that much of what I present here is simply a poor man's version of the equivalent implementation in the behemoth that is [DifferentialEquations.jl](https://docs.sciml.ai/DiffEqDocs/stable/).)\n\n# A generic integrator interface\n[RK4](https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods) seems like a good place to start. We begin by defining a struct to hold the state of the integrator, `(u, tspan)`, where `u` can be anything that implements `similar` and supports basic algebraic operations, and `tspan` is an `AbstractRange` specifying the time interval of problem. The remaining variables are dummies to avoid allocation in a [hot loop](https://en.wikipedia.org/wiki/Hot_spot_(computer_programming)).\n\n\n\n::: {#9ee85a86 .cell execution_count=2}\n``` {.julia .cell-code}\nabstract type AbstractIntegrator end\n\nstruct RK4Integrator{T,S} <: AbstractIntegrator\n    # current solver state\n    u::T\n    tspan::S\n\n    # intermediate variables\n    k1::T\n    k2::T\n    k3::T\n    k4::T\n    tmp::T\n\n    RK4Integrator(u, tspan) = new{typeof(u),typeof(tspan)}(\n        u, tspan, similar(u), similar(u), similar(u), similar(u), similar(u)\n    )\nend\n```\n:::\n\n\nEvery integrator is expected to implement a `step!` method that expects a function `f!` implementing the in-place derivatve, and performs the actual time-stepping.\n\n::: {#dbb558ce .cell execution_count=3}\n``` {.julia .cell-code}\nfunction step!(integrator::RK4Integrator, f!, t)\n    (; u, tspan, k1, k2, k3, k4, tmp) = integrator\n    dt = step(tspan)\n\n    f!(k1, u, t)\n\n    @. tmp = u + dt / 2 * k1\n    f!(k2, tmp, t + dt / 2)\n\n    @. tmp = u + dt / 2 * k2\n    f!(k3, tmp, t + dt / 2)\n\n    @. tmp = u + dt * k3\n    f!(k4, tmp, t + dt)\n\n    @. u += dt / 6 * (k1 + 2 * k2 + 2 * k3 + k4)\n    return u\nend\n```\n\n::: {.cell-output .cell-output-display execution_count=147}\n```\nstep! (generic function with 1 method)\n```\n:::\n:::\n\n\nThen, we require only one generic function that actually loops through the time-steps. Below we just implement a basic version, but there is nothing stopping us from being more sophisticated with adaptive algorithms as well.\n\n::: {#579b1e50 .cell execution_count=4}\n``` {.julia .cell-code}\nfunction solve!(f!, u0, tspan; solver, (callback!)=(iter, integrator) -> nothing)\n    integrator = solver(u0, tspan)\n\n    for iter in eachindex(tspan)\n        step!(integrator, f!, tspan[iter])\n        callback!(iter, integrator)\n    end\nend\n```\n\n::: {.cell-output .cell-output-display execution_count=148}\n```\nsolve! (generic function with 1 method)\n```\n:::\n:::\n\n\nAt this point, we introduce the notion of a callback as a mutating function that takes the input `(iter, integrator)::(Integer, AbstractIntegrator)` and is invoked at the end of every iteration. We will soon see that the callback can be utilized by the user to run custom logic within the integrator loop without ever having to touch the actual internals. In the meanwhile, we can now solve any ordinary differential equation with the RK4 method!\n\n::: {#56708b55 .cell execution_count=5}\n``` {.julia .cell-code}\n    function dfdt!(du, u, t)\n        du[1] = -5. * u[1]\n    end\n\n\tsolve!(dfdt!, [5.], range(0., 1., length=100), solver = RK4Integrator)\n```\n:::\n\n\nNote that this function only provides access to the value of `u` at the last time-step, which is a bit weird since typically we would want the evolution of the state at a time-series. While this was an artifical oversight on my part, it also provides a good opportunity to utilize callbacks to store custom data during the solver steps.\n\n# The callback struct\nGenerally, custom logic can be stateful (i.e, have persistent local variables) and one would need to create a closure over the function that actually performs the mutating action on the state of the integrator. However, Julia offers another alternative; namely, we can define a struct that encapsulates the data, which can then be [invoked as a function](https://docs.julialang.org/en/v1/manual/methods/#Function-like-objects) with access to this data. Since both structs and functions may be invoked by means of a function call syntax, I will generically refer to them as `callables` henceforth.\n\nIn order to define a generic interface, we first need to think about what the general usecase of callbacks would be. Typically we expect that callbacks will have the specific form of evaluating whether a certain `condition` is met at the time of invocation, and if so, it performs a certain `effect` that mutates the state of the integrator. For example, we may want to save a certain variable every 10 iterations, or normalize the state whenever it deviates beyond a certain threshold, etc. So, we define a `Callback` struct as a collection of two callables; (1) `condition` with signature `(iter, integrator) -> bool` and (2) `effect` with signature `(iter, integrator) -> integrator`, although it is intended to be mutating.\n\n::: {#50e4dc34 .cell execution_count=6}\n``` {.julia .cell-code}\nbegin\n\tstruct Callback{C,E}\n\t    \"condition for performing callback: (iter, integrator) -> bool\"\n\t    condition::C\n\t    \"callback function acting on solver state: (iter, integrator) -> integrator\"\n\t    effect::E\n\tend\n\t\n\tcondition(p::Callback) = p.condition\n\teffect(p::Callback) = p.effect\n\t\n\tfunction (p::Callback)(iter, integrator)\n\t    if condition(p)(iter, integrator)\n\t        effect(p)(iter, integrator)\n\t    end\n\t\n\t    return integrator\n\tend\nend\n```\n:::\n\n\nWe can further define a `CallbackList` that sequentially invokes its elements if we have more than one callback.\n\n::: {#3b521b45 .cell execution_count=7}\n``` {.julia .cell-code}\nbegin\n    struct CallbackList\n        callbacks::Vector{Callback}\n    end\n\n    function (p::CallbackList)(iter, integrator)\n        for callback in p.callbacks\n            callback(iter, integrator)\n        end\n\n        return integrator\n    end\n\n    Base.getindex(p::CallbackList, idx) = getindex(p.callbacks, idx)\n    Base.length(p::CallbackList) = length(p.callbacks)\nend\n```\n:::\n\n\nNow that the basic structure is in place, let us implement some common `condition`s. Again, these don't _have_ to be structs, but since the specific use-cases here require statefulness, they are an appropriate choice. Note that we have not placed explicit safegaurds to statically check whether the function call has the right signature, so the program would fail at run-time if the signature does not match what is expected.\n\n::: {#e0da3cac .cell execution_count=8}\n``` {.julia .cell-code}\nbegin\n    # trigger every n iterations\n    mutable struct OnIterElapsed\n        \"number of iterations between trigger\"\n        save_freq::Int\n\n        loop::Bool # if true, continuously fires, otherwise it is a one-shot condition\n        flag::Bool # true if condition has been fired once\n\n        OnIterElapsed(save_freq, loop=true) = new(save_freq, loop, false)\n    end\n\n    function (p::OnIterElapsed)(iter, integrator)\n        res = iszero(iter % p.save_freq)\n        return p.loop ? res : (!p.flag ? (p.flag = res; p.flag) : false)\n    end\n\n    # maybe for saving data to file as a backup during long program runs\n    mutable struct OnRealTimeElapsed\n        \"starting time in seconds\"\n        start_tick::Float64\n        \"number of seconds between trigger\"\n        save_freq::Float64\n\n        # :s - second, :m - minute, :h - hour\n        function OnRealTimeElapsed(freq, unit=:m)\n            if unit == :m\n                freq *= 60\n            elseif unit == :h\n                freq *= 3600\n            elseif unit != :s\n                throw(ArgumentError(\"invalid unit `:$unit`, expected `:s`, `:m` or `:h`\"))\n            end\n\n            new(time(), freq)\n        end\n    end\n\n    # only gets called AFTER an iteration is complete!\n    (p::OnRealTimeElapsed)(iter, state, H, envs) = ((time() - p.start_tick) > p.save_freq) ? (p.start_tick = time(); true) : false\nend\n```\n:::\n\n\nWe now define a generic `effect` that simply computes some specified observables using the integrator state. We do so by defining a struct `RecordObservable` which expects an input `recipe` which is a named tuple of pairs like (`name`, `function to compute observable`). For example; `(modsq = (iter, integrator) -> integrator.u^2, iter = (iter, integrator) -> iter)`. It then stores the result in `data` whenever the `condition` of its parent `Callback` returns `true`. While this is a trivial example, it may be quite useful if there is some internal integrator state (which is not simply the solution `u`) that must be tracked.\n\n::: {#08008529 .cell execution_count=9}\n``` {.julia .cell-code}\nbegin\n    struct RecordObservable{D,O}\n        \"collection of string-array pairs containing observable data\"\n        data::D\n        \"functions to compute observable data\"\n        observables::O\n\n        function RecordObservable(recipe)\n            names = keys(recipe)\n            observables = values(recipe)\n            data = NamedTuple{names}(([] for _ in eachindex(names)))\n            return new{typeof(data),typeof(observables)}(data, observables)\n        end\n    end\n\n    function Base.getproperty(p::RecordObservable, key::Symbol)\n        if key in fieldnames(typeof(p))\n            return getfield(p, key)\n        else\n            return getproperty(p.data, key)\n        end\n    end\n\n    # Base.iterate(p::RecordObservable, i...) = iterate(p.data, i...)\n    Base.length(p::RecordObservable) = length(p.data)\n\n    function (p::RecordObservable)(iter, integrator)\n        for i in 1:length(p)\n            push!(p.data[i], p.observables[i](iter, integrator))\n        end\n\n        return integrator\n    end\nend\n```\n:::\n\n\nWe can now finally record the solution as a time-series at every iteration and visualize it. (Note that it is strictly necessary to wrap the keyword argument `callback!` in paranthesis because there is an ambiguity in syntax due to a possible `!=` otherwise.)\n\n::: {#8dbf90c2 .cell execution_count=10}\n``` {.julia .cell-code}\nlet\n    record_state = Callback(\n        OnIterElapsed(1),\n        RecordObservable((u=(iter, integrator) -> copy(integrator.u),))\n    )\n    solve!(dfdt!, [5.0], range(0.0, 1.0, length=100), solver=RK4Integrator, (callback!)=record_state)\n    plot(first.(record_state.effect.u))\nend\n```\n\n::: {.cell-output .cell-output-display execution_count=154}\n```{=html}\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"672\" height=\"480\" viewBox=\"0 0 2688 1920\">\n<defs>\n  <clipPath id=\"clip400\">\n    <rect x=\"0\" y=\"0\" width=\"2688\" height=\"1920\"/>\n  </clipPath>\n</defs>\n<path clip-path=\"url(#clip400)\" d=\"M0 1920 L2688 1920 L2688 0 L0 0  Z\" fill=\"#ffffff\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<defs>\n  <clipPath id=\"clip401\">\n    <rect x=\"537\" y=\"0\" width=\"1883\" height=\"1883\"/>\n  </clipPath>\n</defs>\n<path clip-path=\"url(#clip400)\" d=\"M115.057 1800.78 L2640.76 1800.78 L2640.76 47.2441 L115.057 47.2441  Z\" fill=\"#ffffff\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<defs>\n  <clipPath id=\"clip402\">\n    <rect x=\"115\" y=\"47\" width=\"2527\" height=\"1755\"/>\n  </clipPath>\n</defs>\n<polyline clip-path=\"url(#clip402)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"162.471,1800.78 162.471,47.2441 \"/>\n<polyline clip-path=\"url(#clip402)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"764.172,1800.78 764.172,47.2441 \"/>\n<polyline clip-path=\"url(#clip402)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"1365.87,1800.78 1365.87,47.2441 \"/>\n<polyline clip-path=\"url(#clip402)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"1967.57,1800.78 1967.57,47.2441 \"/>\n<polyline clip-path=\"url(#clip402)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"2569.27,1800.78 2569.27,47.2441 \"/>\n<polyline clip-path=\"url(#clip402)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"115.057,1762.37 2640.76,1762.37 \"/>\n<polyline clip-path=\"url(#clip402)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"115.057,1412.02 2640.76,1412.02 \"/>\n<polyline clip-path=\"url(#clip402)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"115.057,1061.66 2640.76,1061.66 \"/>\n<polyline clip-path=\"url(#clip402)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"115.057,711.307 2640.76,711.307 \"/>\n<polyline clip-path=\"url(#clip402)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"115.057,360.951 2640.76,360.951 \"/>\n<polyline clip-path=\"url(#clip400)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"115.057,1800.78 2640.76,1800.78 \"/>\n<polyline clip-path=\"url(#clip400)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"162.471,1800.78 162.471,1781.88 \"/>\n<polyline clip-path=\"url(#clip400)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"764.172,1800.78 764.172,1781.88 \"/>\n<polyline clip-path=\"url(#clip400)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1365.87,1800.78 1365.87,1781.88 \"/>\n<polyline clip-path=\"url(#clip400)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1967.57,1800.78 1967.57,1781.88 \"/>\n<polyline clip-path=\"url(#clip400)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"2569.27,1800.78 2569.27,1781.88 \"/>\n<path clip-path=\"url(#clip400)\" d=\"M162.471 1834 Q158.86 1834 157.031 1837.57 Q155.226 1841.11 155.226 1848.24 Q155.226 1855.34 157.031 1858.91 Q158.86 1862.45 162.471 1862.45 Q166.105 1862.45 167.911 1858.91 Q169.74 1855.34 169.74 1848.24 Q169.74 1841.11 167.911 1837.57 Q166.105 1834 162.471 1834 M162.471 1830.3 Q168.281 1830.3 171.337 1834.9 Q174.416 1839.49 174.416 1848.24 Q174.416 1856.96 171.337 1861.57 Q168.281 1866.15 162.471 1866.15 Q156.661 1866.15 153.582 1861.57 Q150.527 1856.96 150.527 1848.24 Q150.527 1839.49 153.582 1834.9 Q156.661 1830.3 162.471 1830.3 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip400)\" d=\"M743.443 1861.55 L759.762 1861.55 L759.762 1865.48 L737.818 1865.48 L737.818 1861.55 Q740.48 1858.79 745.063 1854.16 Q749.67 1849.51 750.85 1848.17 Q753.096 1845.65 753.975 1843.91 Q754.878 1842.15 754.878 1840.46 Q754.878 1837.71 752.933 1835.97 Q751.012 1834.23 747.91 1834.23 Q745.711 1834.23 743.258 1835 Q740.827 1835.76 738.049 1837.31 L738.049 1832.59 Q740.873 1831.46 743.327 1830.88 Q745.781 1830.3 747.818 1830.3 Q753.188 1830.3 756.383 1832.98 Q759.577 1835.67 759.577 1840.16 Q759.577 1842.29 758.767 1844.21 Q757.98 1846.11 755.873 1848.7 Q755.295 1849.37 752.193 1852.59 Q749.091 1855.78 743.443 1861.55 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip400)\" d=\"M769.623 1830.92 L787.98 1830.92 L787.98 1834.86 L773.906 1834.86 L773.906 1843.33 Q774.924 1842.98 775.943 1842.82 Q776.961 1842.64 777.98 1842.64 Q783.767 1842.64 787.146 1845.81 Q790.526 1848.98 790.526 1854.4 Q790.526 1859.97 787.054 1863.08 Q783.581 1866.15 777.262 1866.15 Q775.086 1866.15 772.818 1865.78 Q770.572 1865.41 768.165 1864.67 L768.165 1859.97 Q770.248 1861.11 772.47 1861.66 Q774.693 1862.22 777.169 1862.22 Q781.174 1862.22 783.512 1860.11 Q785.85 1858.01 785.85 1854.4 Q785.85 1850.78 783.512 1848.68 Q781.174 1846.57 777.169 1846.57 Q775.294 1846.57 773.419 1846.99 Q771.568 1847.4 769.623 1848.28 L769.623 1830.92 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip400)\" d=\"M1340.57 1830.92 L1358.93 1830.92 L1358.93 1834.86 L1344.85 1834.86 L1344.85 1843.33 Q1345.87 1842.98 1346.89 1842.82 Q1347.91 1842.64 1348.93 1842.64 Q1354.72 1842.64 1358.09 1845.81 Q1361.47 1848.98 1361.47 1854.4 Q1361.47 1859.97 1358 1863.08 Q1354.53 1866.15 1348.21 1866.15 Q1346.03 1866.15 1343.77 1865.78 Q1341.52 1865.41 1339.11 1864.67 L1339.11 1859.97 Q1341.2 1861.11 1343.42 1861.66 Q1345.64 1862.22 1348.12 1862.22 Q1352.12 1862.22 1354.46 1860.11 Q1356.8 1858.01 1356.8 1854.4 Q1356.8 1850.78 1354.46 1848.68 Q1352.12 1846.57 1348.12 1846.57 Q1346.24 1846.57 1344.37 1846.99 Q1342.52 1847.4 1340.57 1848.28 L1340.57 1830.92 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip400)\" d=\"M1380.69 1834 Q1377.08 1834 1375.25 1837.57 Q1373.44 1841.11 1373.44 1848.24 Q1373.44 1855.34 1375.25 1858.91 Q1377.08 1862.45 1380.69 1862.45 Q1384.32 1862.45 1386.13 1858.91 Q1387.96 1855.34 1387.96 1848.24 Q1387.96 1841.11 1386.13 1837.57 Q1384.32 1834 1380.69 1834 M1380.69 1830.3 Q1386.5 1830.3 1389.55 1834.9 Q1392.63 1839.49 1392.63 1848.24 Q1392.63 1856.96 1389.55 1861.57 Q1386.5 1866.15 1380.69 1866.15 Q1374.88 1866.15 1371.8 1861.57 Q1368.74 1856.96 1368.74 1848.24 Q1368.74 1839.49 1371.8 1834.9 Q1374.88 1830.3 1380.69 1830.3 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip400)\" d=\"M1941.43 1830.92 L1963.65 1830.92 L1963.65 1832.91 L1951.1 1865.48 L1946.22 1865.48 L1958.02 1834.86 L1941.43 1834.86 L1941.43 1830.92 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip400)\" d=\"M1972.82 1830.92 L1991.17 1830.92 L1991.17 1834.86 L1977.1 1834.86 L1977.1 1843.33 Q1978.12 1842.98 1979.14 1842.82 Q1980.15 1842.64 1981.17 1842.64 Q1986.96 1842.64 1990.34 1845.81 Q1993.72 1848.98 1993.72 1854.4 Q1993.72 1859.97 1990.25 1863.08 Q1986.77 1866.15 1980.46 1866.15 Q1978.28 1866.15 1976.01 1865.78 Q1973.77 1865.41 1971.36 1864.67 L1971.36 1859.97 Q1973.44 1861.11 1975.66 1861.66 Q1977.89 1862.22 1980.36 1862.22 Q1984.37 1862.22 1986.71 1860.11 Q1989.04 1858.01 1989.04 1854.4 Q1989.04 1850.78 1986.71 1848.68 Q1984.37 1846.57 1980.36 1846.57 Q1978.49 1846.57 1976.61 1846.99 Q1974.76 1847.4 1972.82 1848.28 L1972.82 1830.92 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip400)\" d=\"M2528.88 1861.55 L2536.52 1861.55 L2536.52 1835.18 L2528.21 1836.85 L2528.21 1832.59 L2536.47 1830.92 L2541.15 1830.92 L2541.15 1861.55 L2548.79 1861.55 L2548.79 1865.48 L2528.88 1865.48 L2528.88 1861.55 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip400)\" d=\"M2568.23 1834 Q2564.62 1834 2562.79 1837.57 Q2560.99 1841.11 2560.99 1848.24 Q2560.99 1855.34 2562.79 1858.91 Q2564.62 1862.45 2568.23 1862.45 Q2571.87 1862.45 2573.67 1858.91 Q2575.5 1855.34 2575.5 1848.24 Q2575.5 1841.11 2573.67 1837.57 Q2571.87 1834 2568.23 1834 M2568.23 1830.3 Q2574.04 1830.3 2577.1 1834.9 Q2580.18 1839.49 2580.18 1848.24 Q2580.18 1856.96 2577.1 1861.57 Q2574.04 1866.15 2568.23 1866.15 Q2562.42 1866.15 2559.34 1861.57 Q2556.29 1856.96 2556.29 1848.24 Q2556.29 1839.49 2559.34 1834.9 Q2562.42 1830.3 2568.23 1830.3 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip400)\" d=\"M2598.39 1834 Q2594.78 1834 2592.95 1837.57 Q2591.15 1841.11 2591.15 1848.24 Q2591.15 1855.34 2592.95 1858.91 Q2594.78 1862.45 2598.39 1862.45 Q2602.03 1862.45 2603.83 1858.91 Q2605.66 1855.34 2605.66 1848.24 Q2605.66 1841.11 2603.83 1837.57 Q2602.03 1834 2598.39 1834 M2598.39 1830.3 Q2604.2 1830.3 2607.26 1834.9 Q2610.34 1839.49 2610.34 1848.24 Q2610.34 1856.96 2607.26 1861.57 Q2604.2 1866.15 2598.39 1866.15 Q2592.58 1866.15 2589.51 1861.57 Q2586.45 1856.96 2586.45 1848.24 Q2586.45 1839.49 2589.51 1834.9 Q2592.58 1830.3 2598.39 1830.3 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><polyline clip-path=\"url(#clip400)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"115.057,1800.78 115.057,47.2441 \"/>\n<polyline clip-path=\"url(#clip400)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"115.057,1762.37 133.955,1762.37 \"/>\n<polyline clip-path=\"url(#clip400)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"115.057,1412.02 133.955,1412.02 \"/>\n<polyline clip-path=\"url(#clip400)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"115.057,1061.66 133.955,1061.66 \"/>\n<polyline clip-path=\"url(#clip400)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"115.057,711.307 133.955,711.307 \"/>\n<polyline clip-path=\"url(#clip400)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"115.057,360.951 133.955,360.951 \"/>\n<path clip-path=\"url(#clip400)\" d=\"M62.7928 1748.17 Q59.1817 1748.17 57.353 1751.74 Q55.5475 1755.28 55.5475 1762.41 Q55.5475 1769.51 57.353 1773.08 Q59.1817 1776.62 62.7928 1776.62 Q66.427 1776.62 68.2326 1773.08 Q70.0613 1769.51 70.0613 1762.41 Q70.0613 1755.28 68.2326 1751.74 Q66.427 1748.17 62.7928 1748.17 M62.7928 1744.47 Q68.6029 1744.47 71.6585 1749.07 Q74.7372 1753.66 74.7372 1762.41 Q74.7372 1771.13 71.6585 1775.74 Q68.6029 1780.32 62.7928 1780.32 Q56.9826 1780.32 53.904 1775.74 Q50.8484 1771.13 50.8484 1762.41 Q50.8484 1753.66 53.904 1749.07 Q56.9826 1744.47 62.7928 1744.47 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip400)\" d=\"M54.8299 1425.36 L62.4687 1425.36 L62.4687 1399 L54.1586 1400.66 L54.1586 1396.4 L62.4224 1394.74 L67.0983 1394.74 L67.0983 1425.36 L74.7372 1425.36 L74.7372 1429.3 L54.8299 1429.3 L54.8299 1425.36 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip400)\" d=\"M58.4178 1075.01 L74.7372 1075.01 L74.7372 1078.94 L52.7928 1078.94 L52.7928 1075.01 Q55.4549 1072.25 60.0382 1067.62 Q64.6446 1062.97 65.8252 1061.63 Q68.0705 1059.1 68.9502 1057.37 Q69.8529 1055.61 69.8529 1053.92 Q69.8529 1051.16 67.9085 1049.43 Q65.9872 1047.69 62.8854 1047.69 Q60.6863 1047.69 58.2326 1048.46 Q55.8021 1049.22 53.0243 1050.77 L53.0243 1046.05 Q55.8484 1044.91 58.3021 1044.34 Q60.7558 1043.76 62.7928 1043.76 Q68.1631 1043.76 71.3576 1046.44 Q74.552 1049.13 74.552 1053.62 Q74.552 1055.75 73.7418 1057.67 Q72.9548 1059.57 70.8483 1062.16 Q70.2696 1062.83 67.1678 1066.05 Q64.0659 1069.24 58.4178 1075.01 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip400)\" d=\"M67.6076 709.953 Q70.964 710.67 72.839 712.939 Q74.7372 715.207 74.7372 718.541 Q74.7372 723.656 71.2187 726.457 Q67.7002 729.258 61.2187 729.258 Q59.0428 729.258 56.728 728.818 Q54.4364 728.402 51.9827 727.545 L51.9827 723.031 Q53.9271 724.165 56.2419 724.744 Q58.5567 725.323 61.0798 725.323 Q65.478 725.323 67.7696 723.587 Q70.0844 721.851 70.0844 718.541 Q70.0844 715.485 67.9317 713.772 Q65.802 712.036 61.9826 712.036 L57.9549 712.036 L57.9549 708.193 L62.1678 708.193 Q65.6169 708.193 67.4455 706.828 Q69.2742 705.439 69.2742 702.846 Q69.2742 700.184 67.3761 698.772 Q65.5011 697.337 61.9826 697.337 Q60.0613 697.337 57.8623 697.754 Q55.6632 698.17 53.0243 699.05 L53.0243 694.883 Q55.6864 694.142 58.0012 693.772 Q60.3391 693.402 62.3993 693.402 Q67.7233 693.402 70.8252 695.832 Q73.927 698.24 73.927 702.36 Q73.927 705.23 72.2835 707.221 Q70.64 709.189 67.6076 709.953 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip400)\" d=\"M65.1539 347.745 L53.3484 366.194 L65.1539 366.194 L65.1539 347.745 M63.927 343.671 L69.8066 343.671 L69.8066 366.194 L74.7372 366.194 L74.7372 370.083 L69.8066 370.083 L69.8066 378.231 L65.1539 378.231 L65.1539 370.083 L49.5521 370.083 L49.5521 365.569 L63.927 343.671 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><polyline clip-path=\"url(#clip402)\" style=\"stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"186.539,96.8724 210.607,178.9 234.675,256.887 258.743,331.034 282.811,401.528 306.879,468.551 330.947,532.273 355.015,592.857 379.083,650.456 403.151,705.219 427.219,757.285 451.288,806.786 475.356,853.85 499.424,898.595 523.492,941.137 547.56,981.584 571.628,1020.04 595.696,1056.6 619.764,1091.36 643.832,1124.41 667.9,1155.83 691.968,1185.7 716.036,1214.1 740.104,1241.1 764.172,1266.78 788.24,1291.19 812.308,1314.39 836.376,1336.46 860.444,1357.43 884.512,1377.38 908.58,1396.34 932.648,1414.37 956.716,1431.51 980.784,1447.8 1004.85,1463.29 1028.92,1478.02 1052.99,1492.03 1077.06,1505.34 1101.12,1518 1125.19,1530.04 1149.26,1541.48 1173.33,1552.36 1197.4,1562.7 1221.46,1572.54 1245.53,1581.89 1269.6,1590.78 1293.67,1599.23 1317.74,1607.26 1341.8,1614.9 1365.87,1622.16 1389.94,1629.07 1414.01,1635.63 1438.08,1641.88 1462.14,1647.81 1486.21,1653.45 1510.28,1658.82 1534.35,1663.92 1558.42,1668.77 1582.48,1673.38 1606.55,1677.76 1630.62,1681.93 1654.69,1685.89 1678.76,1689.66 1702.82,1693.24 1726.89,1696.64 1750.96,1699.88 1775.03,1702.96 1799.1,1705.88 1823.17,1708.67 1847.23,1711.31 1871.3,1713.83 1895.37,1716.22 1919.44,1718.49 1943.51,1720.65 1967.57,1722.71 1991.64,1724.66 2015.71,1726.52 2039.78,1728.28 2063.85,1729.96 2087.91,1731.56 2111.98,1733.08 2136.05,1734.52 2160.12,1735.89 2184.19,1737.2 2208.25,1738.44 2232.32,1739.61 2256.39,1740.74 2280.46,1741.8 2304.53,1742.81 2328.59,1743.78 2352.66,1744.69 2376.73,1745.56 2400.8,1746.39 2424.87,1747.18 2448.93,1747.93 2473,1748.64 2497.07,1749.32 2521.14,1749.96 2545.21,1750.57 2569.27,1751.15 \"/>\n<path clip-path=\"url(#clip400)\" d=\"M2251.57 209.375 L2556.57 209.375 L2556.57 105.695 L2251.57 105.695  Z\" fill=\"#ffffff\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip400)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"2251.57,209.375 2556.57,209.375 2556.57,105.695 2251.57,105.695 2251.57,209.375 \"/>\n<polyline clip-path=\"url(#clip400)\" style=\"stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"2279.63,157.535 2448.01,157.535 \"/>\n<path clip-path=\"url(#clip400)\" d=\"M2489.91 177.223 Q2488.11 181.852 2486.4 183.264 Q2484.68 184.676 2481.81 184.676 L2478.41 184.676 L2478.41 181.112 L2480.91 181.112 Q2482.67 181.112 2483.64 180.278 Q2484.61 179.445 2485.79 176.343 L2486.56 174.399 L2476.07 148.889 L2480.59 148.889 L2488.69 169.167 L2496.79 148.889 L2501.3 148.889 L2489.91 177.223 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip400)\" d=\"M2508.6 170.88 L2516.23 170.88 L2516.23 144.515 L2507.92 146.181 L2507.92 141.922 L2516.19 140.255 L2520.86 140.255 L2520.86 170.88 L2528.5 170.88 L2528.5 174.815 L2508.6 174.815 L2508.6 170.88 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /></svg>\n```\n:::\n:::\n\n\nPerfect! Perhaps a more realistic use-case is to specify dynamical conditions that kick in at some intermediate time, for example, a random kick every `n` iterations. This can be done like so:\n\n::: {#f1709527 .cell execution_count=11}\n``` {.julia .cell-code}\nlet\n    record_state = Callback(\n        OnIterElapsed(1),\n        RecordObservable((u=(iter, integrator) -> copy(integrator.u),))\n    )\n\n    kick_callback = Callback(\n        OnIterElapsed(20),\n        (iter, integrator) -> integrator.u[1] += (2 * rand() - 1),\n    )\n    solve!(dfdt!, [5.0], range(0.0, 1.0, length=100), solver=RK4Integrator, (callback!)=CallbackList([record_state, kick_callback]))\n    plot(first.(record_state.effect.u))\nend\n```\n\n::: {.cell-output .cell-output-display execution_count=155}\n```{=html}\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"672\" height=\"480\" viewBox=\"0 0 2688 1920\">\n<defs>\n  <clipPath id=\"clip490\">\n    <rect x=\"0\" y=\"0\" width=\"2688\" height=\"1920\"/>\n  </clipPath>\n</defs>\n<path clip-path=\"url(#clip490)\" d=\"M0 1920 L2688 1920 L2688 0 L0 0  Z\" fill=\"#ffffff\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<defs>\n  <clipPath id=\"clip491\">\n    <rect x=\"537\" y=\"0\" width=\"1883\" height=\"1883\"/>\n  </clipPath>\n</defs>\n<path clip-path=\"url(#clip490)\" d=\"M115.057 1800.78 L2640.76 1800.78 L2640.76 47.2441 L115.057 47.2441  Z\" fill=\"#ffffff\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<defs>\n  <clipPath id=\"clip492\">\n    <rect x=\"115\" y=\"47\" width=\"2527\" height=\"1755\"/>\n  </clipPath>\n</defs>\n<polyline clip-path=\"url(#clip492)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"162.471,1800.78 162.471,47.2441 \"/>\n<polyline clip-path=\"url(#clip492)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"764.172,1800.78 764.172,47.2441 \"/>\n<polyline clip-path=\"url(#clip492)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"1365.87,1800.78 1365.87,47.2441 \"/>\n<polyline clip-path=\"url(#clip492)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"1967.57,1800.78 1967.57,47.2441 \"/>\n<polyline clip-path=\"url(#clip492)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"2569.27,1800.78 2569.27,47.2441 \"/>\n<polyline clip-path=\"url(#clip492)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"115.057,1749.76 2640.76,1749.76 \"/>\n<polyline clip-path=\"url(#clip492)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"115.057,1402.06 2640.76,1402.06 \"/>\n<polyline clip-path=\"url(#clip492)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"115.057,1054.35 2640.76,1054.35 \"/>\n<polyline clip-path=\"url(#clip492)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"115.057,706.653 2640.76,706.653 \"/>\n<polyline clip-path=\"url(#clip492)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"115.057,358.951 2640.76,358.951 \"/>\n<polyline clip-path=\"url(#clip490)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"115.057,1800.78 2640.76,1800.78 \"/>\n<polyline clip-path=\"url(#clip490)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"162.471,1800.78 162.471,1781.88 \"/>\n<polyline clip-path=\"url(#clip490)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"764.172,1800.78 764.172,1781.88 \"/>\n<polyline clip-path=\"url(#clip490)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1365.87,1800.78 1365.87,1781.88 \"/>\n<polyline clip-path=\"url(#clip490)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1967.57,1800.78 1967.57,1781.88 \"/>\n<polyline clip-path=\"url(#clip490)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"2569.27,1800.78 2569.27,1781.88 \"/>\n<path clip-path=\"url(#clip490)\" d=\"M162.471 1834 Q158.86 1834 157.031 1837.57 Q155.226 1841.11 155.226 1848.24 Q155.226 1855.34 157.031 1858.91 Q158.86 1862.45 162.471 1862.45 Q166.105 1862.45 167.911 1858.91 Q169.74 1855.34 169.74 1848.24 Q169.74 1841.11 167.911 1837.57 Q166.105 1834 162.471 1834 M162.471 1830.3 Q168.281 1830.3 171.337 1834.9 Q174.416 1839.49 174.416 1848.24 Q174.416 1856.96 171.337 1861.57 Q168.281 1866.15 162.471 1866.15 Q156.661 1866.15 153.582 1861.57 Q150.527 1856.96 150.527 1848.24 Q150.527 1839.49 153.582 1834.9 Q156.661 1830.3 162.471 1830.3 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip490)\" d=\"M743.443 1861.55 L759.762 1861.55 L759.762 1865.48 L737.818 1865.48 L737.818 1861.55 Q740.48 1858.79 745.063 1854.16 Q749.67 1849.51 750.85 1848.17 Q753.096 1845.65 753.975 1843.91 Q754.878 1842.15 754.878 1840.46 Q754.878 1837.71 752.933 1835.97 Q751.012 1834.23 747.91 1834.23 Q745.711 1834.23 743.258 1835 Q740.827 1835.76 738.049 1837.31 L738.049 1832.59 Q740.873 1831.46 743.327 1830.88 Q745.781 1830.3 747.818 1830.3 Q753.188 1830.3 756.383 1832.98 Q759.577 1835.67 759.577 1840.16 Q759.577 1842.29 758.767 1844.21 Q757.98 1846.11 755.873 1848.7 Q755.295 1849.37 752.193 1852.59 Q749.091 1855.78 743.443 1861.55 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip490)\" d=\"M769.623 1830.92 L787.98 1830.92 L787.98 1834.86 L773.906 1834.86 L773.906 1843.33 Q774.924 1842.98 775.943 1842.82 Q776.961 1842.64 777.98 1842.64 Q783.767 1842.64 787.146 1845.81 Q790.526 1848.98 790.526 1854.4 Q790.526 1859.97 787.054 1863.08 Q783.581 1866.15 777.262 1866.15 Q775.086 1866.15 772.818 1865.78 Q770.572 1865.41 768.165 1864.67 L768.165 1859.97 Q770.248 1861.11 772.47 1861.66 Q774.693 1862.22 777.169 1862.22 Q781.174 1862.22 783.512 1860.11 Q785.85 1858.01 785.85 1854.4 Q785.85 1850.78 783.512 1848.68 Q781.174 1846.57 777.169 1846.57 Q775.294 1846.57 773.419 1846.99 Q771.568 1847.4 769.623 1848.28 L769.623 1830.92 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip490)\" d=\"M1340.57 1830.92 L1358.93 1830.92 L1358.93 1834.86 L1344.85 1834.86 L1344.85 1843.33 Q1345.87 1842.98 1346.89 1842.82 Q1347.91 1842.64 1348.93 1842.64 Q1354.72 1842.64 1358.09 1845.81 Q1361.47 1848.98 1361.47 1854.4 Q1361.47 1859.97 1358 1863.08 Q1354.53 1866.15 1348.21 1866.15 Q1346.03 1866.15 1343.77 1865.78 Q1341.52 1865.41 1339.11 1864.67 L1339.11 1859.97 Q1341.2 1861.11 1343.42 1861.66 Q1345.64 1862.22 1348.12 1862.22 Q1352.12 1862.22 1354.46 1860.11 Q1356.8 1858.01 1356.8 1854.4 Q1356.8 1850.78 1354.46 1848.68 Q1352.12 1846.57 1348.12 1846.57 Q1346.24 1846.57 1344.37 1846.99 Q1342.52 1847.4 1340.57 1848.28 L1340.57 1830.92 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip490)\" d=\"M1380.69 1834 Q1377.08 1834 1375.25 1837.57 Q1373.44 1841.11 1373.44 1848.24 Q1373.44 1855.34 1375.25 1858.91 Q1377.08 1862.45 1380.69 1862.45 Q1384.32 1862.45 1386.13 1858.91 Q1387.96 1855.34 1387.96 1848.24 Q1387.96 1841.11 1386.13 1837.57 Q1384.32 1834 1380.69 1834 M1380.69 1830.3 Q1386.5 1830.3 1389.55 1834.9 Q1392.63 1839.49 1392.63 1848.24 Q1392.63 1856.96 1389.55 1861.57 Q1386.5 1866.15 1380.69 1866.15 Q1374.88 1866.15 1371.8 1861.57 Q1368.74 1856.96 1368.74 1848.24 Q1368.74 1839.49 1371.8 1834.9 Q1374.88 1830.3 1380.69 1830.3 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip490)\" d=\"M1941.43 1830.92 L1963.65 1830.92 L1963.65 1832.91 L1951.1 1865.48 L1946.22 1865.48 L1958.02 1834.86 L1941.43 1834.86 L1941.43 1830.92 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip490)\" d=\"M1972.82 1830.92 L1991.17 1830.92 L1991.17 1834.86 L1977.1 1834.86 L1977.1 1843.33 Q1978.12 1842.98 1979.14 1842.82 Q1980.15 1842.64 1981.17 1842.64 Q1986.96 1842.64 1990.34 1845.81 Q1993.72 1848.98 1993.72 1854.4 Q1993.72 1859.97 1990.25 1863.08 Q1986.77 1866.15 1980.46 1866.15 Q1978.28 1866.15 1976.01 1865.78 Q1973.77 1865.41 1971.36 1864.67 L1971.36 1859.97 Q1973.44 1861.11 1975.66 1861.66 Q1977.89 1862.22 1980.36 1862.22 Q1984.37 1862.22 1986.71 1860.11 Q1989.04 1858.01 1989.04 1854.4 Q1989.04 1850.78 1986.71 1848.68 Q1984.37 1846.57 1980.36 1846.57 Q1978.49 1846.57 1976.61 1846.99 Q1974.76 1847.4 1972.82 1848.28 L1972.82 1830.92 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip490)\" d=\"M2528.88 1861.55 L2536.52 1861.55 L2536.52 1835.18 L2528.21 1836.85 L2528.21 1832.59 L2536.47 1830.92 L2541.15 1830.92 L2541.15 1861.55 L2548.79 1861.55 L2548.79 1865.48 L2528.88 1865.48 L2528.88 1861.55 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip490)\" d=\"M2568.23 1834 Q2564.62 1834 2562.79 1837.57 Q2560.99 1841.11 2560.99 1848.24 Q2560.99 1855.34 2562.79 1858.91 Q2564.62 1862.45 2568.23 1862.45 Q2571.87 1862.45 2573.67 1858.91 Q2575.5 1855.34 2575.5 1848.24 Q2575.5 1841.11 2573.67 1837.57 Q2571.87 1834 2568.23 1834 M2568.23 1830.3 Q2574.04 1830.3 2577.1 1834.9 Q2580.18 1839.49 2580.18 1848.24 Q2580.18 1856.96 2577.1 1861.57 Q2574.04 1866.15 2568.23 1866.15 Q2562.42 1866.15 2559.34 1861.57 Q2556.29 1856.96 2556.29 1848.24 Q2556.29 1839.49 2559.34 1834.9 Q2562.42 1830.3 2568.23 1830.3 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip490)\" d=\"M2598.39 1834 Q2594.78 1834 2592.95 1837.57 Q2591.15 1841.11 2591.15 1848.24 Q2591.15 1855.34 2592.95 1858.91 Q2594.78 1862.45 2598.39 1862.45 Q2602.03 1862.45 2603.83 1858.91 Q2605.66 1855.34 2605.66 1848.24 Q2605.66 1841.11 2603.83 1837.57 Q2602.03 1834 2598.39 1834 M2598.39 1830.3 Q2604.2 1830.3 2607.26 1834.9 Q2610.34 1839.49 2610.34 1848.24 Q2610.34 1856.96 2607.26 1861.57 Q2604.2 1866.15 2598.39 1866.15 Q2592.58 1866.15 2589.51 1861.57 Q2586.45 1856.96 2586.45 1848.24 Q2586.45 1839.49 2589.51 1834.9 Q2592.58 1830.3 2598.39 1830.3 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><polyline clip-path=\"url(#clip490)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"115.057,1800.78 115.057,47.2441 \"/>\n<polyline clip-path=\"url(#clip490)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"115.057,1749.76 133.955,1749.76 \"/>\n<polyline clip-path=\"url(#clip490)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"115.057,1402.06 133.955,1402.06 \"/>\n<polyline clip-path=\"url(#clip490)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"115.057,1054.35 133.955,1054.35 \"/>\n<polyline clip-path=\"url(#clip490)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"115.057,706.653 133.955,706.653 \"/>\n<polyline clip-path=\"url(#clip490)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"115.057,358.951 133.955,358.951 \"/>\n<path clip-path=\"url(#clip490)\" d=\"M62.7928 1735.56 Q59.1817 1735.56 57.353 1739.12 Q55.5475 1742.66 55.5475 1749.79 Q55.5475 1756.9 57.353 1760.46 Q59.1817 1764.01 62.7928 1764.01 Q66.427 1764.01 68.2326 1760.46 Q70.0613 1756.9 70.0613 1749.79 Q70.0613 1742.66 68.2326 1739.12 Q66.427 1735.56 62.7928 1735.56 M62.7928 1731.85 Q68.6029 1731.85 71.6585 1736.46 Q74.7372 1741.04 74.7372 1749.79 Q74.7372 1758.52 71.6585 1763.13 Q68.6029 1767.71 62.7928 1767.71 Q56.9826 1767.71 53.904 1763.13 Q50.8484 1758.52 50.8484 1749.79 Q50.8484 1741.04 53.904 1736.46 Q56.9826 1731.85 62.7928 1731.85 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip490)\" d=\"M54.8299 1415.4 L62.4687 1415.4 L62.4687 1389.04 L54.1586 1390.7 L54.1586 1386.44 L62.4224 1384.78 L67.0983 1384.78 L67.0983 1415.4 L74.7372 1415.4 L74.7372 1419.34 L54.8299 1419.34 L54.8299 1415.4 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip490)\" d=\"M58.4178 1067.7 L74.7372 1067.7 L74.7372 1071.63 L52.7928 1071.63 L52.7928 1067.7 Q55.4549 1064.95 60.0382 1060.32 Q64.6446 1055.66 65.8252 1054.32 Q68.0705 1051.8 68.9502 1050.06 Q69.8529 1048.3 69.8529 1046.61 Q69.8529 1043.86 67.9085 1042.12 Q65.9872 1040.39 62.8854 1040.39 Q60.6863 1040.39 58.2326 1041.15 Q55.8021 1041.91 53.0243 1043.46 L53.0243 1038.74 Q55.8484 1037.61 58.3021 1037.03 Q60.7558 1036.45 62.7928 1036.45 Q68.1631 1036.45 71.3576 1039.14 Q74.552 1041.82 74.552 1046.31 Q74.552 1048.44 73.7418 1050.36 Q72.9548 1052.26 70.8483 1054.85 Q70.2696 1055.52 67.1678 1058.74 Q64.0659 1061.94 58.4178 1067.7 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip490)\" d=\"M67.6076 705.299 Q70.964 706.017 72.839 708.285 Q74.7372 710.554 74.7372 713.887 Q74.7372 719.003 71.2187 721.803 Q67.7002 724.604 61.2187 724.604 Q59.0428 724.604 56.728 724.165 Q54.4364 723.748 51.9827 722.891 L51.9827 718.378 Q53.9271 719.512 56.2419 720.091 Q58.5567 720.669 61.0798 720.669 Q65.478 720.669 67.7696 718.933 Q70.0844 717.197 70.0844 713.887 Q70.0844 710.831 67.9317 709.118 Q65.802 707.382 61.9826 707.382 L57.9549 707.382 L57.9549 703.54 L62.1678 703.54 Q65.6169 703.54 67.4455 702.174 Q69.2742 700.785 69.2742 698.193 Q69.2742 695.53 67.3761 694.118 Q65.5011 692.683 61.9826 692.683 Q60.0613 692.683 57.8623 693.1 Q55.6632 693.517 53.0243 694.396 L53.0243 690.23 Q55.6864 689.489 58.0012 689.118 Q60.3391 688.748 62.3993 688.748 Q67.7233 688.748 70.8252 691.179 Q73.927 693.586 73.927 697.706 Q73.927 700.577 72.2835 702.567 Q70.64 704.535 67.6076 705.299 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip490)\" d=\"M65.1539 345.745 L53.3484 364.194 L65.1539 364.194 L65.1539 345.745 M63.927 341.671 L69.8066 341.671 L69.8066 364.194 L74.7372 364.194 L74.7372 368.083 L69.8066 368.083 L69.8066 376.231 L65.1539 376.231 L65.1539 368.083 L49.5521 368.083 L49.5521 363.569 L63.927 341.671 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><polyline clip-path=\"url(#clip492)\" style=\"stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"186.539,96.8724 210.607,178.279 234.675,255.675 258.743,329.26 282.811,399.221 306.879,465.736 330.947,528.975 355.015,589.1 379.083,646.263 403.151,700.612 427.219,752.283 451.288,801.41 475.356,848.117 499.424,892.523 523.492,934.743 547.56,974.883 571.628,1013.05 595.696,1049.33 619.764,1083.83 643.832,1116.62 667.9,1166.4 691.968,1195.13 716.036,1222.44 740.104,1248.41 764.172,1273.11 788.24,1296.58 812.308,1318.9 836.376,1340.12 860.444,1360.3 884.512,1379.48 908.58,1397.71 932.648,1415.05 956.716,1431.54 980.784,1447.21 1004.85,1462.11 1028.92,1476.28 1052.99,1489.75 1077.06,1502.55 1101.12,1514.73 1125.19,1526.3 1149.26,1751.15 1173.33,1751.08 1197.4,1751.02 1221.46,1750.96 1245.53,1750.9 1269.6,1750.84 1293.67,1750.79 1317.74,1750.74 1341.8,1750.69 1365.87,1750.64 1389.94,1750.6 1414.01,1750.56 1438.08,1750.52 1462.14,1750.48 1486.21,1750.45 1510.28,1750.41 1534.35,1750.38 1558.42,1750.35 1582.48,1750.32 1606.55,1750.29 1630.62,1604.35 1654.69,1611.51 1678.76,1618.32 1702.82,1624.79 1726.89,1630.95 1750.96,1636.8 1775.03,1642.36 1799.1,1647.65 1823.17,1652.68 1847.23,1657.46 1871.3,1662.01 1895.37,1666.33 1919.44,1670.44 1943.51,1674.34 1967.57,1678.06 1991.64,1681.59 2015.71,1684.95 2039.78,1688.14 2063.85,1691.17 2087.91,1694.06 2111.98,1461.44 2136.05,1475.64 2160.12,1489.14 2184.19,1501.97 2208.25,1514.18 2232.32,1525.78 2256.39,1536.81 2280.46,1547.3 2304.53,1557.27 2328.59,1566.75 2352.66,1575.76 2376.73,1584.33 2400.8,1592.48 2424.87,1600.23 2448.93,1607.59 2473,1614.59 2497.07,1621.25 2521.14,1627.58 2545.21,1633.6 2569.27,1639.32 \"/>\n<path clip-path=\"url(#clip490)\" d=\"M2251.57 209.375 L2556.57 209.375 L2556.57 105.695 L2251.57 105.695  Z\" fill=\"#ffffff\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip490)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"2251.57,209.375 2556.57,209.375 2556.57,105.695 2251.57,105.695 2251.57,209.375 \"/>\n<polyline clip-path=\"url(#clip490)\" style=\"stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"2279.63,157.535 2448.01,157.535 \"/>\n<path clip-path=\"url(#clip490)\" d=\"M2489.91 177.223 Q2488.11 181.852 2486.4 183.264 Q2484.68 184.676 2481.81 184.676 L2478.41 184.676 L2478.41 181.112 L2480.91 181.112 Q2482.67 181.112 2483.64 180.278 Q2484.61 179.445 2485.79 176.343 L2486.56 174.399 L2476.07 148.889 L2480.59 148.889 L2488.69 169.167 L2496.79 148.889 L2501.3 148.889 L2489.91 177.223 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip490)\" d=\"M2508.6 170.88 L2516.23 170.88 L2516.23 144.515 L2507.92 146.181 L2507.92 141.922 L2516.19 140.255 L2520.86 140.255 L2520.86 170.88 L2528.5 170.88 L2528.5 174.815 L2508.6 174.815 L2508.6 170.88 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /></svg>\n```\n:::\n:::\n\n\nI think is quite a nice example demonstrating how the callback pattern allows modularity and extensibility for the user with no need to poke into the internals of the core solver loop. However, it should be noted that design patterns such as this one tend to quickly ramp up in complexity and the overhead introduced both in compilation time and developer maintanence time can often outweigh its usefulness. So its important to keep your specific use-case in mind and try to use them sparingly only when strictly required.\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}